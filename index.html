<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AZTEC - Anonymous Credential Prover</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <!-- Load React -->
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  
  <!-- Load React Router DOM v6 (using a specific version known to work with UMD) -->
  <script src="https://unpkg.com/history@5.3.0/umd/history.production.min.js"></script>
  <script src="https://unpkg.com/react-router@6.3.0/umd/react-router.production.min.js"></script>
  <script src="https://unpkg.com/react-router-dom@6.3.0/umd/react-router-dom.production.min.js"></script>
  
  <!-- Load Babel -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    body {
      background-color: #ffffff !important;
      color: #333333 !important;
      font-family: 'Inter', sans-serif;
    }
    
    /* Override any Tailwind dark mode settings */
    .bg-gray-800, .bg-gray-900, .bg-black {
      background-color: #ffffff !important;
    }
    
    .text-white {
      color: #333333 !important;
    }
    
    /* Only buttons and specific elements should have white text */
    .bg-gradient-to-r.text-white {
      color: white !important;
    }
  </style>
</head>
<body class="bg-white">
  <div id="root" class="bg-white"></div>

  <script type="text/babel">
    // Use HashRouter instead of BrowserRouter for better compatibility with static file serving
    const { HashRouter, Routes, Route, Link, useLocation } = ReactRouterDOM;

    // Navbar Component
    function Navbar() {
      const location = useLocation();
      
      const isActive = (path) => {
        return location.pathname === path;
      };
      
      return (
        <nav className="bg-white text-gray-800 shadow-lg border-b border-[#9D71E8]">
          <div className="container mx-auto px-4 py-4 flex justify-between items-center">
            <Link to="/" className="text-xl font-bold flex items-center">
              <span className="mr-2">üîê</span>
              <span className="bg-clip-text text-transparent bg-gradient-to-r from-[#9D71E8] to-[#C4A8FF]">
                AZTEC
              </span>
            </Link>
            <div className="flex space-x-6">
              <Link 
                to="/" 
                className={`transition-colors ${isActive('/') ? 'text-[#9D71E8]' : 'text-gray-600 hover:text-[#9D71E8]'}`}
              >
                Home
              </Link>
              <Link 
                to="/prove" 
                className={`transition-colors ${isActive('/prove') ? 'text-[#9D71E8]' : 'text-gray-600 hover:text-[#9D71E8]'}`}
              >
                Prove
              </Link>
              <Link 
                to="/admin" 
                className={`transition-colors ${isActive('/admin') ? 'text-[#9D71E8]' : 'text-gray-600 hover:text-[#9D71E8]'}`}
              >
                Admin
              </Link>
              <a 
                href="https://docs.aztec.network/" 
                target="_blank" 
                rel="noopener noreferrer"
                className="text-gray-600 hover:text-[#9D71E8] transition-colors"
              >
                Docs
              </a>
            </div>
          </div>
        </nav>
      );
    }

    // Home Component
    function Home() {
      return (
        <div className="max-w-4xl mx-auto bg-white">
          <div className="text-center mb-16">
            <h1 className="text-5xl font-bold mb-6 bg-clip-text text-transparent bg-gradient-to-r from-[#9D71E8] to-[#C4A8FF]">
              Anonymous Credential Prover
            </h1>
            <p className="text-xl text-gray-600 mb-8">
              Prove you're part of a group without revealing who you are.
            </p>
            <Link 
              to="/prove" 
              className="inline-block bg-gradient-to-r from-[#9D71E8] to-[#C4A8FF] text-white px-8 py-4 rounded-md hover:opacity-90 transition-all shadow-lg text-lg font-medium"
            >
              Start Proof
            </Link>
          </div>

          <div className="grid grid-cols-1 md:grid-cols-2 gap-8 mb-16">
            <div className="bg-white p-6 rounded-lg shadow-md border border-[#9D71E8]">
              <h2 className="text-2xl font-semibold mb-4 text-[#9D71E8]">What is Zero-Knowledge?</h2>
              <p className="text-gray-600">
                Zero-knowledge proofs allow you to prove you know something or have certain attributes without revealing the actual information. It's like proving you're over 21 without showing your ID or revealing your exact age.
              </p>
            </div>
            <div className="bg-white p-6 rounded-lg shadow-md border border-[#9D71E8]">
              <h2 className="text-2xl font-semibold mb-4 text-[#9D71E8]">How It Works</h2>
              <p className="text-gray-600">
                This application uses Aztec's zero-knowledge proof technology to let you prove membership in a group (like a whitelist or DAO) and perform one-time anonymous actions without revealing your identity.
              </p>
            </div>
          </div>

          <div className="bg-white p-6 rounded-lg shadow-md border border-[#9D71E8] mb-16">
            <h2 className="text-2xl font-semibold mb-4 text-[#9D71E8]">Anonymous Actions</h2>
            <p className="text-gray-600 mb-4">
              With your anonymous credential, you can perform one-time actions like:
            </p>
            <ul className="list-disc pl-6 text-gray-600 space-y-2">
              <li>Casting a vote without revealing your identity</li>
              <li>Sending a message anonymously</li>
              <li>Claiming a benefit while maintaining privacy</li>
            </ul>
          </div>
        </div>
      );
    }

    // Prove Component
    function Prove() {
      const [userIndex, setUserIndex] = React.useState(0);
      const [signal, setSignal] = React.useState(1);
      const [loading, setLoading] = React.useState(false);
      const [proof, setProof] = React.useState(null);
      const [error, setError] = React.useState(null);

      const handleGenerateProof = async (e) => {
        e.preventDefault();
        
        try {
          setLoading(true);
          setError(null);
          
          // Simulate API call to generate proof
          setTimeout(() => {
            const mockProof = {
              nullifier_hash: "0x" + Math.random().toString(16).substr(2, 64),
              root: "0x" + Math.random().toString(16).substr(2, 64),
              proof: [
                "0x" + Math.random().toString(16).substr(2, 64),
                "0x" + Math.random().toString(16).substr(2, 64),
                "0x" + Math.random().toString(16).substr(2, 64),
                "0x" + Math.random().toString(16).substr(2, 64),
                "0x" + Math.random().toString(16).substr(2, 64),
                "0x" + Math.random().toString(16).substr(2, 64),
                "0x" + Math.random().toString(16).substr(2, 64),
                "0x" + Math.random().toString(16).substr(2, 64)
              ],
              signal: signal
            };
            
            setProof(mockProof);
            setLoading(false);
          }, 2000);
          
        } catch (err) {
          setError('Failed to generate proof. Please try again.');
          setLoading(false);
          console.error(err);
        }
      };

      const downloadProof = () => {
        if (!proof) return;
        
        const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(proof, null, 2));
        const downloadAnchorNode = document.createElement('a');
        downloadAnchorNode.setAttribute("href", dataStr);
        downloadAnchorNode.setAttribute("download", "proof.json");
        document.body.appendChild(downloadAnchorNode);
        downloadAnchorNode.click();
        downloadAnchorNode.remove();
      };

      return (
        <div className="max-w-3xl mx-auto">
          <div className="text-center mb-8">
            <h1 className="text-4xl font-bold mb-4 bg-clip-text text-transparent bg-gradient-to-r from-[#9D71E8] to-[#C4A8FF]">
              Generate Anonymous Proof
            </h1>
            <p className="text-xl text-gray-600">
              Create a zero-knowledge proof of your membership
            </p>
          </div>

          {error && (
            <div className="bg-red-50 border-l-4 border-red-400 text-red-700 p-4 mb-6 rounded-md">
              <p className="font-bold">Error</p>
              <p>{error}</p>
            </div>
          )}

          <div className="bg-white p-6 rounded-lg shadow-md border border-[#9D71E8] mb-8">
            <form onSubmit={handleGenerateProof}>
              <div className="mb-6">
                <label htmlFor="userIndex" className="block text-[#9D71E8] mb-2 font-medium">
                  Select Your User Index
                </label>
                <select
                  id="userIndex"
                  value={userIndex}
                  onChange={(e) => setUserIndex(parseInt(e.target.value))}
                  className="w-full p-3 bg-white border border-gray-300 rounded-md text-gray-700 focus:border-[#9D71E8] focus:ring focus:ring-[#9D71E8] focus:ring-opacity-50"
                >
                  {[0, 1, 2, 3, 4, 5, 6, 7].map((index) => (
                    <option key={index} value={index}>
                      User {index}
                    </option>
                  ))}
                </select>
                <p className="mt-2 text-sm text-gray-500">
                  This represents your position in the membership Merkle tree.
                </p>
              </div>

              <div className="mb-6">
                <label htmlFor="signal" className="block text-[#9D71E8] mb-2 font-medium">
                  Signal Value
                </label>
                <input
                  id="signal"
                  type="number"
                  min="0"
                  value={signal}
                  onChange={(e) => setSignal(parseInt(e.target.value))}
                  className="w-full p-3 bg-white border border-gray-300 rounded-md text-gray-700 focus:border-[#9D71E8] focus:ring focus:ring-[#9D71E8] focus:ring-opacity-50"
                />
                <p className="mt-2 text-sm text-gray-500">
                  For voting: 1 = Yes, 0 = No, 2 = Abstain
                </p>
              </div>

              <button
                type="submit"
                disabled={loading}
                className="w-full bg-gradient-to-r from-[#9D71E8] to-[#C4A8FF] text-white px-6 py-3 rounded-md hover:opacity-90 transition-all disabled:opacity-50 disabled:cursor-not-allowed shadow-lg"
              >
                {loading ? (
                  <span className="flex items-center justify-center">
                    <svg className="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                      <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                      <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    Generating Proof...
                  </span>
                ) : (
                  'Generate Proof'
                )}
              </button>
            </form>
          </div>

          {proof && (
            <div className="bg-white p-6 rounded-lg shadow-md border border-[#9D71E8] mb-8">
              <h2 className="text-2xl font-semibold mb-4 text-[#9D71E8]">Generated Proof</h2>
              
              <div className="mb-4">
                <h3 className="text-lg font-medium text-[#9D71E8] mb-2">Nullifier Hash</h3>
                <div className="bg-gray-50 p-3 rounded-md overflow-x-auto text-green-600 font-mono">
                  {proof.nullifier_hash}
                </div>
              </div>
              
              <div className="mb-4">
                <h3 className="text-lg font-medium text-[#9D71E8] mb-2">Merkle Root</h3>
                <div className="bg-gray-50 p-3 rounded-md overflow-x-auto text-green-600 font-mono">
                  {proof.root}
                </div>
              </div>
              
              <div className="mb-4">
                <h3 className="text-lg font-medium text-[#9D71E8] mb-2">Signal</h3>
                <div className="bg-gray-50 p-3 rounded-md overflow-x-auto text-green-600 font-mono">
                  {proof.signal}
                </div>
              </div>
              
              <div className="mb-6">
                <h3 className="text-lg font-medium text-[#9D71E8] mb-2">Proof Data</h3>
                <pre className="bg-gray-50 p-3 rounded-md overflow-x-auto text-green-600 font-mono text-sm">
                  {JSON.stringify(proof.proof, null, 2)}
                </pre>
              </div>
              
              <div className="flex flex-col sm:flex-row gap-4">
                <button
                  onClick={downloadProof}
                  className="bg-gradient-to-r from-[#9D71E8] to-[#C4A8FF] text-white px-6 py-3 rounded-md hover:opacity-90 transition-all shadow-lg"
                >
                  Download Proof
                </button>
                
                <Link
                  to="/admin"
                  className="bg-gray-100 text-gray-700 px-6 py-3 rounded-md hover:bg-gray-200 transition-all text-center"
                >
                  Go to Admin Page
                </Link>
              </div>
            </div>
          )}

          <div className="text-center mt-8">
            <Link to="/" className="text-[#9D71E8] hover:text-[#C4A8FF] transition-colors">
              ‚Üê Back to Home
            </Link>
          </div>
        </div>
      );
    }

    // Admin Component
    function Admin() {
      const [proofFile, setProofFile] = React.useState(null);
      const [loading, setLoading] = React.useState(false);
      const [verificationResult, setVerificationResult] = React.useState(null);
      const [error, setError] = React.useState(null);
      
      // Mock data for used nullifiers
      const [usedNullifiers, setUsedNullifiers] = React.useState([
        {
          nullifier_hash: "0x7a23c2b583acb30ccf3a7a0e4b9508ac4f1a860d4c4e5bbd12a1d0041d2d1a23",
          timestamp: "2023-06-15T14:32:45Z",
          signal: 1
        },
        {
          nullifier_hash: "0x9c45e2f89a3e1c4d2a6b8f7e0d5c9b8a7654321f0e1d2c3b4a5678901234567",
          timestamp: "2023-06-14T09:17:22Z",
          signal: 0
        }
      ]);

      const handleFileChange = (e) => {
        if (e.target.files.length > 0) {
          setProofFile(e.target.files[0]);
        }
      };

      const handleVerifyProof = async (e) => {
        e.preventDefault();
        
        if (!proofFile) {
          setError('Please select a proof file');
          return;
        }
        
        try {
          setLoading(true);
          setError(null);
          
          // Read the file
          const reader = new FileReader();
          reader.onload = async (e) => {
            try {
              const proofData = JSON.parse(e.target.result);
              
              // Simulate verification
              setTimeout(() => {
                // Check if nullifier is already used
                const isNullifierUsed = usedNullifiers.some(
                  n => n.nullifier_hash === proofData.nullifier_hash
                );
                
                if (isNullifierUsed) {
                  setVerificationResult({
                    success: false,
                    message: "Nullifier has already been used. Each identity can only perform this action once."
                  });
                } else {
                  // Simulate successful verification
                  setVerificationResult({
                    success: true,
                    message: "Proof verified successfully! The action has been recorded on-chain.",
                    txHash: "0x" + Math.random().toString(16).substr(2, 64)
                  });
                  
                  // Add to used nullifiers
                  setUsedNullifiers([
                    {
                      nullifier_hash: proofData.nullifier_hash,
                      timestamp: new Date().toISOString(),
                      signal: proofData.signal
                    },
                    ...usedNullifiers
                  ]);
                }
                
                setLoading(false);
              }, 2000);
              
            } catch (err) {
              setError('Invalid proof file format');
              setLoading(false);
            }
          };
          
          reader.readAsText(proofFile);
          
        } catch (err) {
          setError('Failed to verify proof. Please try again.');
          setLoading(false);
          console.error(err);
        }
      };

      return (
        <div className="max-w-4xl mx-auto">
          <div className="text-center mb-8">
            <h1 className="text-4xl font-bold mb-4 bg-clip-text text-transparent bg-gradient-to-r from-[#9D71E8] to-[#C4A8FF]">
              Admin Dashboard
            </h1>
            <p className="text-xl text-gray-600">
              Verify proofs and view used nullifiers
            </p>
          </div>

          {error && (
            <div className="bg-red-50 border-l-4 border-red-400 text-red-700 p-4 mb-6 rounded-md">
              <p className="font-bold">Error</p>
              <p>{error}</p>
            </div>
          )}

          {verificationResult && (
            <div className={`${
              verificationResult.success ? 'bg-green-50 border-green-400 text-green-700' : 'bg-red-50 border-red-400 text-red-700'
            } border-l-4 p-4 mb-6 rounded-md`}>
              <p className="font-bold">{verificationResult.success ? 'Success' : 'Verification Failed'}</p>
              <p>{verificationResult.message}</p>
              {verificationResult.txHash && (
                <p className="mt-2">
                  Transaction Hash: <span className="font-mono">{verificationResult.txHash}</span>
                </p>
              )}
            </div>
          )}

          <div className="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
            <div className="bg-white p-6 rounded-lg shadow-md border border-[#9D71E8]">
              <h2 className="text-2xl font-semibold mb-4 text-[#9D71E8]">Verify Proof</h2>
              <form onSubmit={handleVerifyProof}>
                <div className="mb-6">
                  <label className="block text-[#9D71E8] mb-2 font-medium">
                    Upload Proof File
                  </label>
                  <input
                    type="file"
                    accept=".json"
                    onChange={handleFileChange}
                    className="w-full p-3 bg-white border border-gray-300 rounded-md text-gray-700 focus:border-[#9D71E8] focus:outline-none"
                  />
                  <p className="mt-2 text-sm text-gray-500">
                    Upload the proof.json file generated from the Prove page.
                  </p>
                </div>

                <button
                  type="submit"
                  disabled={loading || !proofFile}
                  className="w-full bg-gradient-to-r from-[#9D71E8] to-[#C4A8FF] text-white px-6 py-3 rounded-md hover:opacity-90 transition-all disabled:opacity-50 disabled:cursor-not-allowed shadow-lg"
                >
                  {loading ? (
                    <span className="flex items-center justify-center">
                      <svg className="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                        <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                      </svg>
                      Verifying...
                    </span>
                  ) : (
                    'Verify & Submit Proof'
                  )}
                </button>
              </form>
            </div>

            <div className="bg-white p-6 rounded-lg shadow-md border border-[#9D71E8]">
              <h2 className="text-2xl font-semibold mb-4 text-[#9D71E8]">Used Nullifiers</h2>
              {usedNullifiers.length > 0 ? (
                <div className="overflow-x-auto">
                  <table className="min-w-full">
                    <thead>
                      <tr>
                        <th className="px-4 py-2 text-left text-[#9D71E8]">Nullifier Hash</th>
                        <th className="px-4 py-2 text-left text-[#9D71E8]">Timestamp</th>
                        <th className="px-4 py-2 text-left text-[#9D71E8]">Signal</th>
                      </tr>
                    </thead>
                    <tbody>
                      {usedNullifiers.map((nullifier, index) => (
                        <tr key={index} className="border-t border-gray-200">
                          <td className="px-4 py-2 font-mono text-sm text-gray-700 truncate max-w-[150px]">
                            {nullifier.nullifier_hash}
                          </td>
                          <td className="px-4 py-2 text-gray-700">
                            {new Date(nullifier.timestamp).toLocaleString()}
                          </td>
                          <td className="px-4 py-2 text-gray-700">
                            {nullifier.signal}
                          </td>
                        </tr>
                      ))}
                    </tbody>
                  </table>
                </div>
              ) : (
                <p className="text-gray-500">No nullifiers have been used yet.</p>
              )}
            </div>
          </div>

          <div className="text-center mt-8">
            <Link to="/" className="text-[#9D71E8] hover:text-[#C4A8FF] transition-colors mr-6">
              ‚Üê Back to Home
            </Link>
            <Link to="/prove" className="text-[#9D71E8] hover:text-[#C4A8FF] transition-colors">
              Generate New Proof
            </Link>
          </div>
        </div>
      );
    }

    // App Component
    function App() {
      return (
        <div className="min-h-screen pb-12 pt-0 bg-white">
          <Navbar />
          <div className="container mx-auto px-4 py-8 bg-white">
            <Routes>
              <Route path="/" element={<Home />} />
              <Route path="/prove" element={<Prove />} />
              <Route path="/admin" element={<Admin />} />
            </Routes>
          </div>
          <footer className="text-center text-gray-500 text-sm mt-12 bg-white">
            <p>¬© 2023 AZTEC Anonymous Credential Prover | Privacy-Preserving Technology</p>
          </footer>
        </div>
      );
    }

    // Render the App
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(
      <HashRouter>
        <App />
      </HashRouter>
    );
  </script>
  
  <!-- Add a fallback message for browsers without JavaScript -->
  <noscript>
    <div style="color: #333; text-align: center; padding: 20px;">
      This application requires JavaScript to run.
    </div>
  </noscript>
</body>
</html> 